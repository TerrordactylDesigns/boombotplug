#!/usr/bin/env node
// vim:ft=javascript:
/*<><><><><><><><><><><><><><><><><><><>
              VARIABLES
<><><><><><><><><><><><><><><><><><><>*/
var blacklist
  , commands  = []
  , config    = {}
  , events    = require('../lib/events')
  , load      = require('../lib/load')
  , version   = 'V' + require('../package.json').version
/**/// Private: loadBot
/**///
/**/// Args
/**/// config - parsed config
/**///
/**/// Returns
/**/// bot    - a freshly built shiny new robot
/**///
/**/// Notes
/**/// note   - Duct tapes together a boombot
var loadBot = function(config) {
  var robot = require('../lib/robot')
  bot       = robot.launch(
    config.botinfo.auth + '=?_expires=' + config.botinfo.expires + '==&user_id=' + config.botinfo.userid + '=&v=STIKLg==',
    config.updatecode
  )
  return bot
}
/**/// Private: run
/**///
/**/// Args
/**/// bot        - boombot instance
/**/// events     - event handlers
/**/// commands   - array of bot commands
/**/// config     - parsed config.json
/**/// blacklist  - array of blacklist objects
/**/// version    - bot version
/**///
/**/// Returns
/**/// return     - a fully operational battle station
/**///
/**/// Notes
/**/// note       - tells the robot to listen and respond
var run = function(bot, events, commands, config, version) {
  var robot = require('../lib/robot')
  return robot.run(bot, events, commands, config, version)
}
/**/// Public: where does he get those wonderful toys?
/**///
/**/// Returns
/**/// return - a shiny new robot
var RunBot = function() {
  config      = load.ParseConfig(version)
  // TODO
  // theres gotta be a better way for this next part
  // but im going test happy and just needed them split for now...
  commands    = load.LoadCore(commands)
  commands    = load.LoadOptional(commands)
  var bot     = loadBot(config)
    , boombot = run(bot, events, commands, config, version)
}

module.exports = RunBot()